# Introduction to vulnerability management
In these notes we will explore **vulnerability management** in depth for your organization. We will understand what a vulnerability is, how do we scan for them, and score and prioritise them with the information we can gather, so we can then report about them in an actionable way to get them fixed.

## Vulnerabilities explained
Vulnerabilities are **weaknesses** in an information system, its system security procedures, internal control, or implementation that could be **exploited** or triggered by a threat source. It means it's a weakness that could allow an attacker to **compromise a system or network**.

### Vulnerabilities and risks
It's important to differentiate between risks and vulnerabilities. Risks almost always exist as a potential for loss or negative impact, **We can have risks without vulnerabilities**, like natural disasters, that need to be considered but we have no control over. **We can also have vulnerabilities without risk**, when the vulnerability does not present an issue due to no exploits being available, or the system not having any real data or movement possibilities. Vulnerabilities with risk need the system to be vulnerable, in a system of value, where an exploit exists.

### Vulnerability sources
Vulnerabilities can have many causes:
- **System misconfigurations** like cloud file storage being set as public (public s3 buckets)
- **Missing or weak authorization controls**, like default passwords on applications or appliances
- **Unpatched systems** using old versions of software for which vulnerabilities are discovered
- **Zero-day vulnerabilities** that affect fully patched software, as the vulnerability was unknown
- **Humans**, as people can be socially engineered or can be insider threats themselves stealing internal data to sell

**Vulnerabilities can be found anywhere**: applications on your stack or your system (remote code execution, buffer overflow), websites (cross-site scripting, file inclusion, directory traversal), your operating system (privilege escalation), or your hardware.

### Patching and mitigation
**Attackers routinely exploit old vulnerabilities**. Because a lot of people do not patch these systems that have them, these vulnerabilities are still available to use on their environments and can be exploited. Some devices can't be patched, like embedded devices or medical hardware. The top 12 exploits currently being exploited are usually **5 year old vulnerabilities or more**. These all have available patches, but the target environment may not have applied that patch for a number of reasons. If it can't be patched, some mitigations should be applied if available.

## Vulnerability discovery
**Vulnerabilities are found in different ways** depending if they are new or known. If they are knew, they are discovered through **active attacks** (like zero-day campaigns in the wild) or **vendor and security research announcements** that notify a prtoduct's customers. If they are known, we may use different types of software or services to find those vulnerabilities on our environment, like **security scanners** or **penetration testing services**.

Vulnerability scanning software or services are useful, because they will **prioritise and score their findings** so you can focus your efforts on what has the biggest impact and needs attention first. This way, your work can stay focused on mitigating or eliminating the largest available risks.

### Vulnerability scanning
A vulnerability scanner is a **system designed to scan your infrastructure** for vulnerabilities: **endpoints**, **servers**, **appliances**, **network devices**, anything that could be vulnerable to security issues. A list of **assets** is provided, sometimes in asset groups, and the software scans them and generates **reports** about them that we can act on.

The scanning method depends on they type of system being scanned, and what type of vulnerability is being scanned for. **Port scans**, **service version information** and **file version changes** are common examples. Scanners can be **network-based** (primarly scanning for network vulnerabilities), **host-based** (to scan workstations and servers), **application scanners** (for applications installed on a system), **database scanners** for database server vulnerabilities, and much more. Generally commercial vendors group all of these into a single software suite.

There are also several scan types:
- **Unauthenticated and authenticated**, depending if credentials for the system are provided, as with credentials, the scanner can provide further analysis and better data for the results. On the other hand, unauthenticated scans will give a closer picture of what an attacker can see
- **Internal and external**, which scans internal resources (database servers, email servers), or external resources (exposed webservers). Again, an internal scan will show more data, but an external attack will show what an attacker can see on your permiter, also checking firewall rules and attack paths
- **Scheduled and on-demand**, depending if we want a scheduled security report every so often, or if you want an on-demand check of a new system you don't want to expose without a scan, and you don't want to wait for the on-demand scan to pass it.
- **Agent and agentless**, as some commercial security scanners run an agent inside of the target system to report data back to the scanner system, and agents can automate and provide more information about the host it runs on. If you run virtual machines, part of their setup should include installing this agent so they are automatically covered in your scope and inventory.

#### Scanning process
Scanning usually runs in a set of **steps**:
- **Vulnerability scanner configuration**: setting up the inventory and its asset groups based on our target scope and what systems we want to scan (some tools can even auto-discover your inventory with discovery scans), schedule automatic scheduled scanning if desired and set the scanning types we want to run
- **Launching the scans** if they are manual, or letting the automated scans run
- Analyzing the **reporting** provided to us by the executed scans with target hosts, vulnerabilties and open services
- **Remediating** the vulnerabilities that have been found and prioritized by your tool and your security team. Remediation includes re-testing the vulnerability to make sure everything is patched as expected

### Vulnerability scoring
Vulnerabilities are **assessed in a set of risks** to come up with a score, with the purpose of being able to **prioritise** what needs to be fixed first. 9-10-score vulnerabilities are **critical** and a large risk, whereas a 0-2-score vulnerability is **low severity** and can be omitted to fix higher risks first, so response to the most pressing issues happens first. Higher scores also often get more media attention due to their impact.

Vulnerabilities are scored using the CVSS standard, or **Common Vulnerability Scoring System**. It holds three types of main metrics to calculate risk:
- The **base score**, 
- The **temporal score**
- The **environmental score**

Each of these are scored by **severity levels**:
- **Non** (0)
- **Low** (0.1 - 3.9)
- **Medium** (4.0 - 6.9), where usually the real danger starts
- **High** (7.0 - 8.9), the vulnerabilities that should be patched quickly because they represent a real risk
- **Critical** (9.0 - 10), the vulnerabilities that need to be patched as soon as possible dropping everything else

These potential risks are scored based on a number of **criteria**:
- **Exploitability**: what's the attack vector? is it exploitable over the internet? Is it local-only? Does it require user interaction? What are the necessary privileges? What's the impact on confidentiality, integrity and availability?
- **Impact**: What is the vulnerability capable of? remote code execution? system compromise? denial of service?
- Is there an **exploit** in the wild?
- Is there a **patch available**? What are the **remediation steps**?
- Is the product **present in your infrastructure**? If so, **how critical** is that system? **How many** of these systems do you have?
- What is the **data sensitivity** that may leak? Is it just a development environment, or is it your production system?

Vulnerability information can be gathered from several public sources that are maintained by organizations. The standard used to identify them is CVE (**Common Vulnerabilities and Exposures**), operated by MITRE, that identifies, defines and catalogs publicly disclosed vulnerabilities. 

When someone requests a CVE entry, a CNA (**CVE Numbering Authority**) will handle the process. It will start as reserved with a number, but without much information, to get everything ready to be published. When everything is ready, it will be published. CVE's can also be rejected if they are improperly assigned to a reserved state. These CVE's are usually formatted as `CVE-[full year]-[CVE Number]`. The full process is usually:
- Someone will **discover** a vulnerability
- They will **report** the vulnerability to whoever needs to handle it
- If it appears valid, the organization will **request** a CVE
- The number will be **reserved** for that CVE
- The rest of the necessary information will be **submitted** to the CVE authority
- When everything is ready, the CVE will be **published**

We can check these CVE databases in several public sites, like NVD (the National Vulnerability Database) managed by the US government's NIST (**National Institute of Standards and Technology**). These plarforms usually offer additional information, like CVSS scores, available fixes and their versions, their impact rating, or affected third-party software that may use that software, like if it's a library.

### Vulnerability analytics and reporting
Risk analysis is the process of **identifying**, **managing** and **safeguarding assets** in your organization. It will provide a structured way of identifying and prioritizing risks and threats, which can reduce costs to your organization. It can also avoid regulatory and legal issues, as it may help avoid some compliance checks, as well as reducing the risk of data breaches and compromises.

This risk analysis procedure **generally involves different teams** depending on your scope of analyisis: your security team, IT, legal, compliance... And it follows a set process:
- Ask **questions**
  - What are the organization's **critical assets**?
  - What are the **business processes** that use these assets?
  - What **threats** could affect those processes and assets?
- Get an **asset inventory**
  - Include **priority of systems**, to help prioritizing the most important resources first
- Identify the **threats and vulnerabilities**
  - Use **CVE announcements**, **vulnerability assessments**, any resources you can apply for **risk investigation**
- Analyze **controls**
  - What systems are in place to **mitigate threat**?
- Determine the **likelihood** of an event occurring
  - Use your discovered **attack vectors**
  - Check your vulnerabilities' **CVSS scores**
- Assess the **impact of a threat** if realized
  - Make a list of **possible outcomes** if a vulnerability is exploited, like if a data breach occurs, or if there is a critical system outage
- Based on these risks, **prioritize your risk** to take action

Once this risk assessment is completed, a **vulnerability report** will be produced. This is a document used to provide an overall picture of current vulnerabilities. It will count and categorize vulnerabilities found, list them by product and operating system, with the inventory. It serves as a **summary** for leadership with a **high-level overview** of current risks and vulnerabilities, that can be **simplified** with charts and graphs, and close it with **action items for relevant parties**, like what the IT teams need to do to patch these issues. Other reports can be more technical, for teams that need to patch an application, which are normally vulnerability lists sorted by severity.

Some tools provide these reports in **interactive dashboards** that can be used to extract data over time, to understand how your organization's security posture is evolving. However, these scans are automated, instead of the ones that are explained above. Both have their place: scanner reports are usually **for the security team only**, or the technical team if needed, but these reports are not designed to be given to leadership.

**Manually compiled reports**, however, are often received when a 3rd-party assesment is done. The information may be slightly different to focus on actionable information, and includes **executive** summaries laying out the scope and vulnerabilities, and a table with the vulnerability count and severities, but they are supposed to paint a **better picture of overall vulnerability risk**. They are written to tell a story of why those vulnerabilities are important, and how to fix them, not just a list of vulnerability entries. The data from the automated report is put in and reformatted for the manual report.


The most important part of a manually compiled report is **context**. We need to know why a vulnerability is especially dangerous in our organization, taking into account the rest of our infrastructure and applications and how those amplify or reduce the risk of exploitation and lateral movement. What does that vulnerability mean **to you**? Why is it **important**?

### Vulnerability operations management
Vulnerability management and change management programs are usually **very tied together**, as vulnerability fixes are handled through changes to your environment and systems. Communication and documentation on how to tackle a vulnerability are key, and maybe regular meetings with different teams should be set, like IT (appying fixes), security (running scans, writing reports) and leadership (reviewing and acting upon the executive summary), to **track impact of new vulnerabilities** and how **older vulnerabilities are being handled** so far.

This operations management requires **clearly defined roles and responsibilities**: what should each team be doing when a vulnerability appears? What teams are responsible for what parts? **Operationalizing** this procedure is also very useful, so setting a process will greatly speed up assessment.
